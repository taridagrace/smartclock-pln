<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Daftar Izin - SmartClock HRD</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/style.css" />
</head>

<body class="bg-[#edf2f7] font-[Poppins] text-gray-800">

  <!-- HEADER -->
  <header class="flex justify-between items-center bg-white shadow p-4 sticky top-0 z-20">
    <div class="flex items-center space-x-3">
      <img src="assets/logo_pln.png" alt="Logo PLN" class="h-12 w-auto" />
      <h1 class="text-xl font-bold text-[#69c7d9]">SMARTCLOCK HRD</h1>
    </div>
    <div id="hrd-name" class="text-right flex items-center gap-4"></div>
  </header>

  <div class="flex min-h-screen">
    <!-- SIDEBAR -->
    <aside class="w-64 bg-white shadow-md p-5 space-y-4">
      <nav class="space-y-2">
        <button onclick="window.location.href='dashboard.html'" class="menu-btn w-full text-left px-3 py-2 rounded-lg hover:bg-[#e0f7fa]">Dashboard</button>
        <button onclick="window.location.href='employees.html'" class="menu-btn w-full text-left px-3 py-2 rounded-lg hover:bg-[#e0f7fa]">Daftar Karyawan</button>
        <button class="menu-btn w-full text-left px-3 py-2 rounded-lg active">Daftar Izin</button>
        <button onclick="window.location.href='absensi.html'" class="menu-btn w-full text-left px-3 py-2 rounded-lg hover:bg-[#e0f7fa]">Daftar Absensi</button>
        <button id="menu-logout" class="menu-btn w-full text-left px-3 py-2 rounded-lg hover:bg-[#e0f7fa] text-red-500">Logout</button>
      </nav>
    </aside>

    <!-- MAIN -->
    <main class="flex-1 p-8">
      <div class="bg-white shadow rounded-xl p-6">
        <div class="flex flex-wrap justify-between items-center mb-4 gap-4">
          <h3 class="text-lg font-semibold text-[#69c7d9]">DATA IZIN</h3>
          <div class="flex items-center space-x-3">
            <!-- FILTER STATUS -->
            <label for="filter-status" class="text-sm text-gray-600">Status:</label>
            <select id="filter-status" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#69c7d9] focus:outline-none">
              <option value="semua">Semua</option>
              <option value="disetujui">Disetujui</option>
              <option value="ditolak">Ditolak</option>
              <option value="pending">Pending</option>
            </select>

            <!-- SEARCH BAR -->
            <label for="search" class="text-sm text-gray-600">Cari:</label>
            <input id="search" type="text" placeholder="Masukkan nama karyawan..." class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#69c7d9] focus:outline-none w-64" />
          </div>
        </div>

        <div class="overflow-x-auto rounded-lg border border-gray-200">
          <table class="w-full text-sm text-left">
            <thead class="bg-[#69c7d9] text-white">
              <tr>
                <th class="px-3 py-2">ID Karyawan</th>
                <th class="px-3 py-2">Nama</th>
                <th class="px-3 py-2">Tanggal</th>
                <th class="px-3 py-2">Alasan</th>
                <th class="px-3 py-2">Status</th>
              </tr>
            </thead>
            <tbody id="izin-table"></tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <script>
    const tbody = document.getElementById("izin-table");
    const searchInput = document.getElementById("search");
    const filterSelect = document.getElementById("filter-status");
    let izinData = [];

    async function loadIzin() {
      try {
        const res = await fetch("api/get_all_izin.php");
        const j = await res.json();
        if (!j.success) throw new Error("Data gagal dimuat");
        izinData = j.data;
        renderTable(izinData);
      } catch (err) {
        console.error(err);
        tbody.innerHTML = `<tr><td colspan="5" class="px-3 py-2 text-center text-red-500">Gagal memuat data</td></tr>`;
      }
    }

    function renderTable(data) {
      if (!Array.isArray(data) || data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="5" class="px-3 py-2 text-center">Tidak ada data izin</td></tr>`;
        return;
      }
      tbody.innerHTML = data.map((i, idx) => {
        const rowBg = idx % 2 === 0 ? "bg-[#f9fafb]" : "bg-white";
        let badge = "";
        if (i.status === "disetujui" || i.status === "approved") {
          badge = `<span class="bg-green-100 text-green-700 px-2 py-1 rounded-full text-xs font-semibold">Disetujui</span>`;
        } else if (i.status === "ditolak" || i.status === "rejected") {
          badge = `<span class="bg-red-100 text-red-700 px-2 py-1 rounded-full text-xs font-semibold">Ditolak</span>`;
        } else {
          badge = `<span class="bg-yellow-100 text-yellow-700 px-2 py-1 rounded-full text-xs font-semibold">Pending</span>`;
        }
        return `
          <tr class="${rowBg}">
            <td class="px-3 py-2">${i.karyawan_id}</td>
            <td class="px-3 py-2">${i.nama}</td>
            <td class="px-3 py-2">${i.tanggal}</td>
            <td class="px-3 py-2">${i.alasan}</td>
            <td class="px-3 py-2">${badge}</td>
          </tr>
        `;
      }).join("");
    }

    function filterAndRender() {
      const keyword = searchInput.value.toLowerCase();
      const selectedStatus = filterSelect.value;
      const filtered = izinData.filter(i => {
        const matchNama = i.nama.toLowerCase().includes(keyword);
        const matchStatus =
          selectedStatus === "semua" ||
          i.status.toLowerCase() === selectedStatus ||
          (selectedStatus === "disetujui" && i.status.toLowerCase() === "approved") ||
          (selectedStatus === "ditolak" && i.status.toLowerCase() === "rejected");
        return matchNama && matchStatus;
      });
      renderTable(filtered);
    }

    searchInput.addEventListener("input", filterAndRender);
    filterSelect.addEventListener("change", filterAndRender);

    document.addEventListener("DOMContentLoaded", () => {
      loadIzin();
      document.getElementById("menu-logout")?.addEventListener("click", async () => {
        await fetch("api/hrd_logout.php");
        window.location.href = "login.php";
      });
    });
  </script>

  <script src="js/hrd_main.js"></script>
</body>
</html>
