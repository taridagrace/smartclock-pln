<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daftar Absensi - SmartClock HRD</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; }
    .active { background-color: #69c7d9; color: white; }
  </style>
</head>

<body class="bg-[#edf2f7] font-[Poppins] text-gray-800">

  <!-- HEADER -->
  <header class="flex justify-between items-center bg-white shadow p-4 sticky top-0 z-20">
    <div class="flex items-center space-x-3">
      <img src="assets/logo_pln.png" alt="Logo PLN" class="h-12 w-auto">
      <h1 class="text-xl font-bold text-[#69c7d9]">SMARTCLOCK HRD</h1>
    </div>
    <div id="hrd-name" class="text-right flex items-center gap-4"></div>
  </header>

  <div class="flex min-h-screen">
    <!-- SIDEBAR -->
    <aside class="w-64 bg-white shadow-md p-5 space-y-4">
      <nav class="space-y-2">
        <button onclick="window.location.href='dashboard.html'"
          class="menu-btn w-full text-left px-3 py-2 rounded-lg hover:bg-[#e0f7fa]">Dashboard</button>
        <button onclick="window.location.href='employees.html'"
          class="menu-btn w-full text-left px-3 py-2 rounded-lg hover:bg-[#e0f7fa]">Daftar Karyawan</button>
        <button onclick="window.location.href='izin.html'"
          class="menu-btn w-full text-left px-3 py-2 rounded-lg hover:bg-[#e0f7fa]">Daftar Izin</button>
        <button class="menu-btn w-full text-left px-3 py-2 rounded-lg active">Daftar Absensi</button>
        <button id="menu-logout"
          class="menu-btn w-full text-left px-3 py-2 rounded-lg hover:bg-[#e0f7fa] text-red-500">Logout</button>
      </nav>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 p-8">
      <div class="bg-white shadow-md rounded-2xl p-6">
        <!-- Header Card -->
        <div class="flex flex-wrap justify-between items-center mb-4 gap-2">
          <h3 class="text-lg font-semibold text-[#69c7d9]">DATA ABSENSI LENGKAP</h3>

          <div class="flex items-center space-x-3">
            <!-- FILTER STATUS -->
            <div class="flex items-center space-x-2">
              <label for="statusFilter" class="text-sm text-gray-500">Status:</label>
              <select id="statusFilter" class="border rounded-full px-3 py-1 text-sm focus:outline-none focus:ring-1 focus:ring-[#69c7d9]">
                <option value="semua">Semua</option>
                <option value="hadir">Hadir</option>
                <option value="terlambat">Terlambat</option>
                <option value="izin">Izin</option>
                <option value="alpha">Alpha</option>
              </select>
            </div>

            <!-- SEARCH BAR -->
            <div class="flex items-center space-x-2">
              <label for="search" class="text-sm text-gray-500">Cari:</label>
              <input id="search" type="text" placeholder="Masukkan nama karyawan..."
                class="border rounded-full px-3 py-1 text-sm focus:outline-none focus:ring-1 focus:ring-[#69c7d9]" />
            </div>
          </div>
        </div>

        <!-- TABEL -->
        <div class="overflow-x-auto">
          <table class="w-full text-sm text-left border-t">
            <thead class="bg-[#69c7d9] text-white">
              <tr>
                <th class="px-3 py-2">ID Karyawan</th>
                <th class="px-3 py-2">Nama</th>
                <th class="px-3 py-2">Tanggal</th>
                <th class="px-3 py-2">Jam Masuk</th>
                <th class="px-3 py-2">Jam Keluar</th>
                <th class="px-3 py-2">Status</th>
              </tr>
            </thead>
            <tbody id="absensi-table"></tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <script>
    const tbody = document.getElementById("absensi-table");
    const searchInput = document.getElementById("search");
    const statusFilter = document.getElementById("statusFilter");
    let absensiData = [];

    async function loadAbsensi() {
      try {
        const res = await fetch("api/hrd_get_absensi.php");
        const j = await res.json();
        if (!j.success) throw new Error("Data gagal dimuat");
        absensiData = j.data;
        renderTable(absensiData);
      } catch (err) {
        console.error(err);
        tbody.innerHTML = `<tr><td colspan="6" class="px-3 py-2 text-center text-red-500">Gagal memuat data</td></tr>`;
      }
    }

    function renderTable(data) {
      if (!Array.isArray(data) || data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="6" class="px-3 py-2 text-center">Tidak ada data absensi</td></tr>`;
        return;
      }

      tbody.innerHTML = data.map((a, idx) => {
        const rowBg = idx % 2 === 0 ? "bg-[#f9fafb]" : "bg-white";
        let statusClass = "";
        const status = a.status ? a.status.toLowerCase() : "";

        switch (status) {
          case "hadir": statusClass = "bg-green-100 text-green-700"; break;
          case "alpha": statusClass = "bg-red-100 text-red-700"; break;
          case "izin": statusClass = "bg-yellow-100 text-yellow-700"; break;
          case "terlambat": statusClass = "bg-blue-100 text-blue-700"; break;
          default: statusClass = "bg-gray-100 text-gray-700";
        }

        return `
          <tr class="${rowBg}">
            <td class="px-3 py-2">${a.karyawan_id}</td>
            <td class="px-3 py-2">${a.nama}</td>
            <td class="px-3 py-2">${a.tanggal}</td>
            <td class="px-3 py-2">${a.jam_masuk || '-'}</td>
            <td class="px-3 py-2">${a.jam_keluar || '-'}</td>
            <td class="px-3 py-2">
              <span class="px-2 py-1 rounded-full text-xs font-semibold ${statusClass}">
                ${a.status || '-'}
              </span>
            </td>
          </tr>
        `;
      }).join("");
    }

    // Fungsi untuk filter status
    function applyFilters() {
      const keyword = searchInput.value.toLowerCase();
      const selectedStatus = statusFilter.value.toLowerCase();

      const filtered = absensiData.filter(a => {
        const matchNama = a.nama.toLowerCase().includes(keyword);
        const matchStatus = selectedStatus === "semua" || (a.status && a.status.toLowerCase() === selectedStatus);
        return matchNama && matchStatus;
      });

      renderTable(filtered);
    }

    searchInput.addEventListener("input", applyFilters);
    statusFilter.addEventListener("change", applyFilters);

    // Logout
    document.getElementById('menu-logout').addEventListener('click', async () => {
      await fetch('api/hrd_logout.php');
      window.location.href = 'login.php';
    });

    loadAbsensi();
  </script>

  <script src="js/hrd_main.js"></script>
</body>
</html>
